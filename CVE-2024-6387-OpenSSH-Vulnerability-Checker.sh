#!/bin/bash

# Function to get the installed OpenSSH version
get_openssh_version() {
    version_info=$(ssh -V 2>&1)
    version=$(echo $version_info | awk '{print $1 " " $2}')
    echo $version_info | awk '{print $2}'
}

# Function to check if the version is vulnerable
is_vulnerable() {
    version=$1
    if [[ $version == OpenSSH* ]]; then
        version_number=$(echo $version | cut -d'_' -f2)
        major=$(echo $version_number | cut -d'p' -f1 | cut -d'.' -f1)
        minor=$(echo $version_number | cut -d'p' -f1 | cut -d'.' -f2)
        patch=$(echo $version_number | cut -d'p' -f2)
        
        if (( major < 4 )) || (( major == 4 && minor < 4 )); then
            echo "Vulnerable unless patched for CVE-2006-5051 and CVE-2008-4109"
        elif (( 4 <= major && major < 8 )) || (( major == 8 && minor < 5 )); then
            echo "Not vulnerable if patched for CVE-2006-5051"
        elif (( 8 <= major && major < 9 )) || (( major == 9 && minor < 8 )); then
            echo "Vulnerable"
        else
            echo "Not vulnerable"
        fi
    else
        echo "Unknown version format"
    fi
}

# Get and print the OpenSSH version
version=$(get_openssh_version)
echo "OpenSSH version: $version"

# Check if the version is vulnerable
vulnerability_status=$(is_vulnerable $version)
echo "Vulnerability status: $vulnerability_status"
